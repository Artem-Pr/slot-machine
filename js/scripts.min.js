"use strict";

window.onload = function () {
  var btnStart = document.querySelector('.btn-start');
  var reel = document.querySelector('.reel');
  var reelWrapper = reel.querySelector('.reel__wrapper');
  var reelSpeed = 5;
  var landPositions = {
    top: 1,
    center: 2,
    bottom: 3
  };
  var firstReelContainer = reel.querySelector('.reel__container');
  var symbols = ['BAR', '2xBAR', '3xBAR', '7', 'CHERRY'];
  var translation = 0;

  function getRandomSymbols(symbols) {
    var j = 0,
        temp,
        mountOfElements = symbols.length;

    while (mountOfElements--) {
      j = Math.floor(Math.random() * (mountOfElements + 1));
      temp = symbols[mountOfElements];
      symbols[mountOfElements] = symbols[j];
      symbols[j] = temp;
    }

    return symbols;
  }

  function setCertainPosition(symbolsArr, goalRow, goalSymbol) {
    if (goalRow && goalSymbol) {
      var rowNumber = landPositions[goalRow];

      while (symbolsArr[rowNumber] !== goalSymbol) {
        symbolsArr.unshift(symbolsArr.pop());
      }
    }
  }

  function createReelContainer(randomSymbolsArr) {
    var newReelContainer = document.createElement('div');
    newReelContainer.className = 'reel__container';

    for (var i = 1; i <= reelSpeed; i++) {
      translation = 100 * i;
      var newReelWrapper = createReelWrapper(randomSymbolsArr);
      newReelContainer.prepend(newReelWrapper);
    }

    return newReelContainer;
  }

  function createReelWrapper(randomSymbolsArr) {
    var newReelWrapper = document.createElement('div');
    newReelWrapper.className = 'reel__wrapper';
    createImage(randomSymbolsArr, newReelWrapper);
    newReelWrapper.style.transform = 'translateY(' + -translation + '%)';
    return newReelWrapper;
  }

  function createImage(symbolsArr, wrapper) {
    symbolsArr.forEach(function (item) {
      var reelImg = document.createElement('img');
      reelImg.src = 'img/reel/' + item + '.png';
      reelImg.alt = item;
      reelImg.className = 'reel__img';
      wrapper.append(reelImg);
    });
  }

  function removeObsoleteItems() {
    if (reel.childElementCount > 1) reel.children[1].remove();
  }

  var randomSymbols = getRandomSymbols(symbols);
  createImage(randomSymbols, reelWrapper);
  btnStart.addEventListener('click', function (e) {
    e.target.disabled = true;
    var reelContainer = reel.querySelector('.reel__container');
    var goalRow = document.querySelector('.goal-row').value;
    var goalSymbol = document.querySelector('.goal-symbol').value;
    var randomSymbols = getRandomSymbols(symbols);
    removeObsoleteItems();
    setCertainPosition(randomSymbols, goalRow, goalSymbol);
    var newReelContainer = createReelContainer(randomSymbols);
    reel.prepend(newReelContainer);
    setTimeout(function () {
      newReelContainer.style.transform = 'translateY(' + translation + '%)';

      if (firstReelContainer) {
        firstReelContainer.style.transform = 'translateY(' + translation + '%)';
        firstReelContainer = null;
      } else reelContainer.style.transform = 'translateY(' + translation * 2 + '%)';
    });
    setTimeout(function () {
      e.target.disabled = false;
    }, 2000);
  });
};